# 内网渗透基础

#### 攻击流程
1. 信息收集 : 内网权限， CS，MSF
2. 漏洞利用 ：拿到shell, 后上线CS
3. 权限提升
4. 权限维持
5. 隧道技术
6. 内网渗透

### 什么是内网？  
- 指局域网，区域内多台计算机互连成的计算机组
- 范围数千里以内
- 可实现文件管理、应用软件共享、摄像头、打印机共享、工作组内的日程安排、电子邮件和传真通信服务等
- 有web服务器、mails服务器、交换机
- 有VPN、IPS、firewall、IDS
- 可从Demilitarized Zone(DMZ)区、分支机构、内网办公区、外来接入区、内网服务器区，进行攻击
  
### Windows工作组(Group)介绍
- 须启用密码保护共享，否则网路连接的电脑也会被控制
1. 加入工作组 ：System -> Domain Name or Workgroup -> Computer Name
2. 创建工作组
3. 退出工作组
4. 访问工作组 : Network
     - 须两个以上电脑以网络连接，通过网段192.168.x.1/24
  
#### 工作组优缺点
- **优点**：方便管理和维护、资源分配方便和灵活
- **缺点**：
  - 缺乏集中管理与控制的机制 - 没有管理员
  - 没有集中的统一账号管理 - 每个电脑有不同账号名与密码
  - 只适合小规模用户使用
    
## Windows域
- 计算机网络形式
- 所有用户账号，计算机，打印机和其他按前言主体都在于域控制器（Domain Controller,DC）的一个或多个中央计算机集群上的中央数据库注册。
- 权限身份证认证在域控制器上进行

1. **域（Domain）**: 一个有安全边界的计算机集合，管理控制机制比工作组更严格，所以在于一个域中的用户无法访问在另一个域里的资源，如要访问须有合法与权限身份证登入域。
2. **域控制器 （DC）**：域中的一台类似管理服务器计算机。域的账号和密码保存在域控制器里，如果信息有一项不正确，就会拒绝用户通过登录且不能访问服务器中的资源。
3. **单域**：需要至少两台域服务器：一台DC，一台备份DC.
4. **父域和子域** ：出于管理及其他需求，需要在网络中划分多个域。
    - 第一个域成为父域，各分部的域称为子域。如：大公司与分公司位于不同地点。
    - 情况一，如果把分公司放在同一个域，计算机之间的信息交互（包括同步，复制等）上花费的时间会比较长，占用宽带也会大。
    - 情况二，出于安全策略，如财务部为一个子域单独管理以使用特定的安全策略。
5. **域树（Tree)** ：多个域通过建立信任关系组成的集合。一个域管理员只能管理本域，不能访问其他域。两个域之前需要互访则需要建立信任关系。
    - 可跨网络分配文件和打印机等设备及资源、资源共享与管理、通信及数据传输
6. **域森林（Forest）**：多个域树通过建立信任关系组成的集合，如：域树abc.com与域树 abc. net之间需要通过建立信任关系来构成域森林。

### 域名服务器 （Domain Name Server, DNs)
**什么是DNs?**
- DNs是指用于实现域名( Domain Name)和与之相对的IP地址转换的服务器。
- 域树中的域名和DNS域名非常相似。
- 计算机使用DNS来定位域控制器、服务器及其他计算机、网络服务。
- 域的名字
  就是DNS域的名字。
- 在内网渗透测试中,大都是通过寻找DNS服务器来确定域控制器的位置的(DNS
  服务器和域控制器通常配置在同一机器上)。
  
#### 安全域的划分
1. 安全级别最低：**外网**
    - 外网不能访问内网，可以访问DMZ
2. 安全级别中等：**DMZ**
    - DMZ不能访问内网与外网
3. 安全级别最高： **内网**
    - 可以访问外网与DMZ
    
#### 域中计算机分类
1. 域控制器 : 用于管理所有的网络访问,包括登录服务器、访问共享目录和资源。
2. 成员服务器 ：安装了服务器操作系统并加入了域、但没有安装活动目录的计算机,其主要任务是提供网络资源
3. 客户机 ：计算机安装了其他操作系统的计算机
4. 独立服务器 ：和域没有关系
